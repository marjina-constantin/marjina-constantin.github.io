import{u as k,a as E,i as c,m as x,h as T,j as r}from"./index-0Q4orPYt.js";import{r as w}from"./react-vendor-DObCo5uo.js";import{H as I,a as v}from"./charts-vendor-BgOMIWtF.js";import"./icons-vendor-CjON0rrL.js";const u={salary:"Salary",bonus:"Bonuses",freelance:"Freelance",overtime:"Overtime",interest:"Interest",gift:"Gifts",cashback:"Cashback",sale:"Sales",loan:"Loans"};function G(){const{data:p}=k(),{currency:j}=E(),d=p.filteredIncomeData!==null?p.filteredIncomeData||[]:p.incomeData||[],m=w.useMemo(()=>{if(!d||d.length===0)return{pieData:[],lineData:{},months:[]};const h={};c.forEach(e=>{const t=u[e]||e;h[t]=0});let f=0;const s={},b=new Set;d.forEach(e=>{const t=parseFloat(e.sum||"0"),n=new Date(e.dt),a=`${x[n.getMonth()]} ${n.getFullYear()}`;b.add(a),s[a]||(s[a]={},c.forEach(o=>{const l=u[o]||o;s[a][l]=0}),s[a].untagged=0);let i=!1;for(const o of c)if(e.dsc&&T(e.dsc,o)){const l=u[o]||o;h[l]+=t,s[a][l]+=t,i=!0;break}i||(f+=t,s[a].untagged+=t)});const y=c.map(e=>{const t=u[e]||e;return{name:t,y:parseFloat(h[t].toFixed(2))}}).filter(e=>e.y>0);f>0&&y.push({name:"Untagged",y:parseFloat(f.toFixed(2))});const g=Array.from(b).sort((e,t)=>{const n=e.split(" "),a=t.split(" "),i=x.indexOf(n[0]),o=x.indexOf(a[0]),l=parseInt(n[1]),F=parseInt(a[1]);return l!==F?l-F:i-o}),O=["Salary","Interest"],D=c.map(e=>{const t=u[e]||e,n=g.map(a=>{var i;return parseFloat((((i=s[a])==null?void 0:i[t])||0).toFixed(2))});return n.some(a=>a>0)?{name:t,data:n,visible:O.includes(t)}:null}).filter(e=>e!==null),S=g.map(e=>{var t;return parseFloat((((t=s[e])==null?void 0:t.untagged)||0).toFixed(2))});return S.some(e=>e>0)&&D.push({name:"Untagged",data:S,visible:!1}),{pieData:y,lineSeries:D,months:g}},[d]),A={chart:{type:"pie"},title:{text:"Income Sources Breakdown"},tooltip:{pointFormat:"{point.y} {series.name} ({point.percentage:.2f})%"},plotOptions:{pie:{allowPointSelect:!0,borderWidth:0}},series:[{name:j,colorByPoint:!0,data:m.pieData}],credits:{enabled:!1}},B={chart:{type:"line",zoomType:"x"},boost:{useGPUTranslations:!0},title:{text:"Income Evolution by Source"},xAxis:{categories:m.months,crosshair:!0},yAxis:{title:{text:"Amount"},min:0},tooltip:{shared:!0,split:!1},plotOptions:{line:{marker:{enabled:!0}}},credits:{enabled:!1},series:m.lineSeries};return m.pieData.length===0?r.jsxs("div",{children:[r.jsx("h3",{children:"Income Sources"}),r.jsx("p",{children:"No income data available. Add income entries with tags like #salary, #freelance, #bonus, #interest, or #refund."})]}):r.jsxs("div",{children:[r.jsx("div",{style:{marginBottom:"2rem"},children:r.jsx(I,{highcharts:v,options:A})}),r.jsx("div",{children:r.jsx(I,{highcharts:v,options:B})})]})}export{G as default};
