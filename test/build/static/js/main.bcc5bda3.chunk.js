(this["webpackJsonpreact-expenses"]=this["webpackJsonpreact-expenses"]||[]).push([[0],{35:function(e,t,n){},36:function(e,t,n){},44:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(24),c=n.n(o),i=(n(35),n(36),n(9)),s=n(2),l=n(12),u=n.n(l),d=n(25),j=n.n(d),h=n(26),b=n.n(h),f=n(10),p=n.n(f),O=n(14),v="https://dev-expenses-api.pantheonsite.io";function g(e,t){return m.apply(this,arguments)}function m(){return(m=Object(O.a)(p.a.mark((function e(t,n){var a,r,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},e.prev=1,t({type:"REQUEST_LOGIN"}),e.next=5,fetch("".concat(v,"/user/login/google?_format=json"),a);case 5:return r=e.sent,e.next=8,r.json();case 8:if(!(o=e.sent).current_user){e.next=13;break}return t({type:"LOGIN_SUCCESS",payload:o}),localStorage.setItem("currentUser",JSON.stringify(o)),e.abrupt("return",o);case 13:t({type:"LOGIN_ERROR",error:o.errors[0]}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t({type:"LOGIN_ERROR",error:e.t0});case 19:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}function x(){return(x=Object(O.a)(p.a.mark((function e(t,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"LOGOUT"}),n({type:"REMOVE_DATA"}),localStorage.removeItem("currentUser"),localStorage.removeItem("token");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=n(5),w=n(3),_=localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")):"",S={userDetails:_,token:localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")).jwt_token:"",loading:!1,errorMessage:null,userIsLoggedIn:!!_},k={groupedData:null,totals:null,filtered:null},C=function(e,t){switch(t.type){case"REQUEST_LOGIN":return Object(w.a)(Object(w.a)({},e),{},{loading:!0});case"LOGIN_SUCCESS":return Object(w.a)(Object(w.a)({},e),{},{userDetails:t.payload,token:t.payload.jwt_token,loading:!1,userIsLoggedIn:!0});case"LOGOUT":return Object(w.a)(Object(w.a)({},e),{},{user:"",token:"",userIsLoggedIn:!1});case"LOGIN_ERROR":return Object(w.a)(Object(w.a)({},e),{},{loading:!1,errorMessage:t.error});default:throw new Error("Unhandled action type: ".concat(t.type))}},D=function(e,t){switch(t.type){case"SET_DATA":return Object(w.a)(Object(w.a)({},e),{},{groupedData:t.groupedData,totals:t.totals,raw:t.raw});case"FILTER_DATA":if(""!==t.category){var n=e.raw.filter((function(e){return e.field_category===t.category})),a={},r={};n.forEach((function(e){var t=new Date(e.field_date),n="".concat(t.toLocaleString("default",{month:"long"})," ").concat(t.getFullYear());a[n]||(a[n]=[]),r[n]||(r[n]=0),a[n].push(e),r[n]+=parseInt(e.field_amount)}));var o={groupedData:a,totals:r};return Object(w.a)(Object(w.a)({},e),{},{filtered:o,category:t.category})}return Object(w.a)(Object(w.a)({},e),{},{filtered:null,category:""});case"REMOVE_DATA":return k;default:throw new Error("Unhandled action type: ".concat(t.type))}},E=n(0),T=r.a.createContext(),N=r.a.createContext(),A=r.a.createContext();function I(){var e=r.a.useContext(T);if(void 0===e)throw new Error("useAuthState must be used within a AuthProvider");return e}function L(){var e=r.a.useContext(A);if(void 0===e)throw new Error("useData must be used within a AuthProvider");return e}function P(){var e=r.a.useContext(N);if(void 0===e)throw new Error("useAuthDispatch must be used within a AuthProvider");return e}var R=function(e){var t=e.children,n=Object(a.useReducer)(C,S),r=Object(y.a)(n,2),o=r[0],c=r[1],i=Object(a.useReducer)(D,k),s=Object(y.a)(i,2),l=s[0],u=s[1];return Object(E.jsx)(T.Provider,{value:o,children:Object(E.jsx)(N.Provider,{value:c,children:Object(E.jsx)(A.Provider,{value:{data:l,dataDispatch:u},children:t})})})},U=function(e){return e.ok?e.json():e.statusText},F=function(e,t,n){fetch(e,t).then(U).then((function(e){return n(e)})).catch((function(e){return console.log(e)}))},M=function(e,t){var n={method:"GET",headers:new Headers({Accept:"application/json","Content-Type":"application/json","JWT-Authorization":"Bearer "+e})};F("https://dev-expenses-api.pantheonsite.io/user-expenses?_format=json",n,(function(e){var n={},a={};e.forEach((function(e){var t=new Date(e.field_date),r="".concat(t.toLocaleString("default",{month:"long"})," ").concat(t.getFullYear());n[r]||(n[r]=[]),a[r]||(a[r]=0),n[r].push(e),a[r]+=parseInt(e.field_amount)})),t({type:"SET_DATA",raw:e,groupedData:n,totals:a})}))},W=[{value:"",label:"Category"},{value:"1",label:"Clothing"},{value:"2",label:"Entertainment"},{value:"3",label:"Food"},{value:"4",label:"Gifts"},{value:"5",label:"Household Items/Supplies"},{value:"6",label:"Housing"},{value:"7",label:"Medical/Healthcare"},{value:"8",label:"Personal"},{value:"9",label:"Transportation"},{value:"10",label:"Utilities"}];function G(){var e=L(),t=e.data,n=e.dataDispatch;return Object(E.jsx)("div",{className:"filters",children:Object(E.jsx)("select",{name:"category",onChange:function(e){var t=e.target.value;n({type:"FILTER_DATA",category:t})},children:W.map((function(e,n){return Object(E.jsx)("option",{selected:t.category===e.value,value:e.value,children:e.label},n)}))})})}b()(u.a);var J=function(){var e=L(),t=e.data,n=e.dataDispatch,r=null===t.groupedData,o=I().token;Object(a.useEffect)((function(){r&&M(o,n)}),[t]);var c=t.filtered||t,i={chart:{type:"column"},title:{text:"Monthly Totals"},xAxis:{categories:c.totals?Object.keys(c.totals).reverse():[]},yAxis:{min:0,title:{text:"MDL"},stackLabels:{style:{color:"#FFFFFF",fontWeight:"bold"},enabled:!0,verticalAlign:"top"}},plotOptions:{column:{pointPadding:.2,borderWidth:0,stacking:"normal",groupPadding:0},series:{colorByPoint:!0}},series:[{name:t.category?W.find((function(e){return e.value===t.category})).label:"Monthly totals",data:c.totals?Object.values(c.totals).reverse():[]}]};return Object(E.jsxs)("div",{children:[Object(E.jsx)("h2",{children:"Charts page"}),Object(E.jsx)(G,{}),Object(E.jsx)("div",{className:"charts-page",children:Object(E.jsx)(j.a,{highcharts:u.a,options:i})})]})};function B(e){var t=e.show,n=e.onClose,r=e.children,o=Object(a.useRef)();return Object(a.useEffect)((function(){var e=function(e){t&&o.current&&!o.current.contains(e.target)&&n(e)};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[t]),Object(E.jsx)(E.Fragment,{children:t?Object(E.jsx)("div",{className:"modal-window",children:Object(E.jsxs)("div",{ref:o,children:[Object(E.jsx)("a",{href:"#",onClick:n,title:"Close",className:"modal-close",children:"Close"}),r]})}):""})}var H=n(18),q=function(e){var t=e.formType,n=e.values,r=e.onSuccess,o={field_amount:"",field_date:(new Date).toISOString().substr(0,10),field_category:"",field_description:""},c=Object(a.useState)("add"===t?o:n),i=Object(y.a)(c,2),s=i[0],l=i[1],u=I().token,d=function(e){var t=e.target.value;l(Object(w.a)(Object(w.a)({},s),{},Object(H.a)({},e.target.name,t)))};return Object(E.jsxs)("div",{children:[Object(E.jsx)("h2",{children:"add"===t?"Add transaction":"Edit transaction"}),Object(E.jsxs)("form",{className:"add-transaction",onSubmit:function(e){e.preventDefault();var a={type:"transaction",title:[s.field_date],field_amount:[s.field_amount],field_category:[s.field_category],field_date:[s.field_date],field_description:[s.field_description]},c={method:"add"===t?"POST":"PATCH",headers:new Headers({Accept:"application/json","Content-Type":"application/json","JWT-Authorization":"Bearer "+u}),body:JSON.stringify(a)},i="add"===t?"https://dev-expenses-api.pantheonsite.io/node?_format=json":"https://dev-expenses-api.pantheonsite.io/node/".concat(n.nid,"?_format=json");F(i,c,(function(e){e.nid?(r(),alert("Success!"),l(o)):alert("Something went wrong, please contact Constantin :)")}))},children:[Object(E.jsx)("input",{required:!0,placeholder:"Amount",type:"number",name:"field_amount",value:s.field_amount,onChange:d}),Object(E.jsx)("input",{required:!0,placeholder:"Date",type:"date",name:"field_date",value:s.field_date,onChange:d}),Object(E.jsx)("select",{required:!0,name:"field_category",value:s.field_category,onChange:d,children:W.map((function(e,t){return Object(E.jsx)("option",{value:e.value,children:e.label},t)}))}),Object(E.jsx)("textarea",{placeholder:"Description",name:"field_description",rows:"3",value:s.field_description,onChange:d}),Object(E.jsx)("input",{type:"submit",value:"add"===t?"Add transaction":"Edit transaction"})]})]})},Y=n(29);function z(e){var t,n=e.month,r=e.total,o=e.items,c=e.handleEdit,i=e.setShowDeleteModal,s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Object(a.useState)(t),r=Object(y.a)(n,2),o=r[0],c=r[1];return{sortedItems:Object(a.useMemo)((function(){var t=Object(Y.a)(e);return null!==o&&t.sort((function(e,t){return"ascending"===o.direction?e[o.key]-t[o.key]:t[o.key]-e[o.key]})),t}),[e,o]),requestSort:function(e){var t="ascending";o&&o.key===e&&"ascending"===o.direction&&(t="descending"),c({key:e,direction:t})},sortConfig:o}}(o),l=s.sortedItems,u=s.requestSort,d=s.sortConfig;return Object(E.jsxs)("div",{className:"table-wrapper",children:[Object(E.jsxs)("div",{className:"month-badge",children:[n,": ",r]}),Object(E.jsxs)("table",{className:"expenses-table",cellSpacing:"0",cellPadding:"0",children:[Object(E.jsx)("thead",{children:Object(E.jsxs)("tr",{children:[Object(E.jsx)("th",{children:"Date"}),Object(E.jsx)("th",{onClick:function(){return u("field_amount")},className:"sortable ".concat((t="field_amount",d&&d.key===t?d.direction:"")),children:"Amount"}),Object(E.jsx)("th",{children:"Category"}),Object(E.jsx)("th",{children:"Description"}),Object(E.jsx)("th",{}),Object(E.jsx)("th",{})]})}),Object(E.jsx)("tbody",{children:l.map((function(e,t){return Object(E.jsxs)("tr",{children:[Object(E.jsx)("td",{children:e.field_date}),Object(E.jsx)("td",{children:e.field_amount}),Object(E.jsx)("td",{children:e.field_category_name}),Object(E.jsx)("td",{children:e.field_description}),Object(E.jsx)("td",{children:Object(E.jsx)("button",{"data-values":JSON.stringify({nid:e.nid,field_date:e.field_date,field_amount:e.field_amount,field_category:e.field_category,field_description:e.field_description}),onClick:c,className:"btn-outline",children:"Edit"})}),Object(E.jsx)("td",{children:Object(E.jsx)("button",{"data-nid":e.nid,onClick:function(e){return i(e.currentTarget.getAttribute("data-nid"))},className:"btn-outline",children:"Delete"})})]},e.nid)}))})]})]})}var Q=function(){var e,t=I(),n=t.userDetails,r=t.token,o=Object(a.useState)(!1),c=Object(y.a)(o,2),i=c[0],s=c[1],l=Object(a.useState)(!1),u=Object(y.a)(l,2),d=u[0],j=u[1],h=L(),b=h.data,f=h.dataDispatch,p=null===b.groupedData;Object(a.useEffect)((function(){p&&M(r,f)}),[b]);var O=Object(a.useState)({}),v=Object(y.a)(O,2),g=v[0],m=v[1],x=function(e){var t=JSON.parse(e.currentTarget.getAttribute("data-values"));m(t),j(!0)},w=function(e,t){!function(e,t,n){var a={method:"DELETE",headers:new Headers({Accept:"application/json","Content-Type":"application/json","JWT-Authorization":"Bearer "+t})};fetch("https://dev-expenses-api.pantheonsite.io/node/".concat(e,"?_format=json"),a).then((function(e){n(e)}))}(e,t,(function(e){e.ok?alert("Transaction was successfully deleted."):alert("Something went wrong."),s(!1),M(t,f)}))},_=b.filtered||b;return Object(E.jsxs)("div",{children:[Object(E.jsxs)(B,{show:i,onClose:function(e){e.preventDefault(),s(!1)},children:[Object(E.jsx)("h3",{children:"Are you sure you want to delete the transaction?"}),Object(E.jsx)("button",{onClick:function(){return w(i,r)},className:"button logout",children:"Yes, remove the transaction"})]}),Object(E.jsx)(B,{show:d,onClose:function(e){e.preventDefault(),j(!1)},children:Object(E.jsx)(q,{formType:"edit",values:g,onSuccess:function(){j(!1),M(r,f)}})}),Object(E.jsx)("h2",{children:"Expenses"}),Object(E.jsxs)("h4",{children:["Hi, ",null===n||void 0===n||null===(e=n.current_user)||void 0===e?void 0:e.name,"!"]}),Object(E.jsx)(G,{}),p?"":Object(E.jsx)("div",{children:Object.keys(_.groupedData).map((function(e,t){return Object(E.jsx)(z,{total:_.totals[e],month:e,items:_.groupedData[e],handleEdit:x,setShowDeleteModal:s},t)}))})]})},V=n(27),X=n.n(V),$=[{path:"/test/build",component:function(){var e=P(),t=Object(s.g)(),n=I(),a=n.loading,r=n.errorMessage;n.userIsLoggedIn&&t.push("/test/home");var o=function(){var n=Object(O.a)(p.a.mark((function n(a){var r;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={access_token:a.accessToken},n.prev=1,n.next=4,g(e,r);case 4:if(n.sent.current_user){n.next=7;break}return n.abrupt("return");case 7:t.push("/test/home"),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),console.log(n.t0);case 13:case"end":return n.stop()}}),n,null,[[1,10]])})));return function(e){return n.apply(this,arguments)}}();return Object(E.jsxs)("div",{children:[Object(E.jsx)("h4",{children:"Please login using Google in order to access app functionality."}),r?Object(E.jsxs)("p",{children:["We have some errors: ",r]}):null,Object(E.jsx)(X.a,{clientId:"954790461001-2p4vab8hud9u6mj4n6hb6iio4uaiofe5.apps.googleusercontent.com",buttonText:"Login",render:function(e){return Object(E.jsx)("button",{onClick:e.onClick,className:"button logout",disabled:a,children:"Log in"})},onSuccess:o,onFailure:function(e){console.log(e)},cookiePolicy:"single_host_origin",disabled:a})]})},isPrivate:!1},{path:"/test/charts",component:J,isPrivate:!0},{path:"/test/home",component:Q,isPrivate:!0},{path:"/test/logout",component:function(){var e=P(),t=L().dataDispatch,n=Object(s.g)();return Object(E.jsxs)("div",{children:[Object(E.jsx)("h3",{children:"Do you want to logout?"}),Object(E.jsx)("button",{className:"button logout",onClick:function(a){a.preventDefault(),function(e,t){x.apply(this,arguments)}(e,t),n.push("/test/build")},children:"Logout"})]})},isPrivate:!0},{path:"/test/add-transaction",component:function(){var e=I().token,t=L().dataDispatch;return Object(E.jsx)(q,{formType:"add",onSuccess:function(){M(e,t)}})},isPrivate:!0}],K=n(16);function Z(){var e=I().userIsLoggedIn,t=Object(a.useState)("closed"),n=Object(y.a)(t,2),r=n[0],o=n[1],c=Object(a.useState)(null),s=Object(y.a)(c,2),l=s[0],u=s[1],d=Object(a.useState)(null),j=Object(y.a)(d,2),h=j[0],b=j[1];return Object(E.jsx)("div",{className:"navbar ".concat(r),onTouchStart:function(e){return function(e){var t=e.touches[0];u(t.clientX),b(t.clientY)}(e)},onTouchMove:function(e){return function(e){if(l&&h){var t=e.touches[0].clientX,n=e.touches[0].clientY,a=l-t,r=h-n;Math.abs(a)<Math.abs(r)&&o(r>0?"open":"closed"),u(null),b(null)}}(e)},children:Object(E.jsxs)("ul",{children:[Object(E.jsx)("li",{children:Object(E.jsx)(i.b,{activeClassName:"selected",className:"not-selected",to:"/test/home",exact:!0,children:Object(E.jsx)(K.b,{})})}),Object(E.jsx)("li",{children:Object(E.jsx)(i.b,{to:"/test/charts",activeClassName:"selected",className:"not-selected",exact:!0,children:Object(E.jsx)(K.a,{})})}),Object(E.jsx)("li",{children:Object(E.jsx)(i.b,{to:"/test/add-transaction",activeClassName:"selected",className:"not-selected",exact:!0,children:Object(E.jsx)(K.c,{})})}),e?Object(E.jsx)("li",{children:Object(E.jsx)(i.b,{to:"/test/logout",activeClassName:"selected",className:"not-selected",exact:!0,children:Object(E.jsx)(K.d,{})})}):""]})})}var ee=n(30),te=function(e){var t=e.component,n=e.path,a=e.isPrivate,r=Object(ee.a)(e,["component","path","isPrivate"]),o=I();return Object(E.jsx)(s.b,Object(w.a)({path:n,render:function(e){return a&&!Boolean(o.token)?Object(E.jsx)(s.a,{to:{pathname:"/test/build"}}):Object(E.jsx)(t,Object(w.a)({},e))}},r))};var ne=function(){return Object(E.jsx)(R,{children:Object(E.jsxs)(i.a,{children:[Object(E.jsx)(Z,{}),Object(E.jsx)(s.d,{children:$.map((function(e){return Object(E.jsx)(te,{exact:!0,path:e.path,component:e.component,isPrivate:e.isPrivate},e.path)}))})]})})},ae=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function re(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,45)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),o(e),c(e)}))};c.a.render(Object(E.jsx)(r.a.StrictMode,{children:Object(E.jsx)(ne,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/test/build",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/test/build","/service-worker.js");ae?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):re(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):re(t,e)}))}}({onUpdate:function(e){window.location.reload()}}),oe()}},[[44,1,2]]]);
//# sourceMappingURL=main.bcc5bda3.chunk.js.map