(this["webpackJsonpreact-expenses"]=this["webpackJsonpreact-expenses"]||[]).push([[0],{29:function(e,t,n){},30:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n.n(o),c=n(21),r=n.n(c),i=(n(29),n(30),n(9)),s=n(2),l=n(0),u=function(){return Object(l.jsx)("h2",{children:"Charts page"})},d=n(5),j=n(10),h=n.n(j),p=n(13),b="https://dev-expenses-api.pantheonsite.io";function f(e,t){return O.apply(this,arguments)}function O(){return(O=Object(p.a)(h.a.mark((function e(t,n){var o,a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},e.prev=1,t({type:"REQUEST_LOGIN"}),e.next=5,fetch("".concat(b,"/user/login/google?_format=json"),o);case 5:return a=e.sent,e.next=8,a.json();case 8:if(!(c=e.sent).current_user){e.next=13;break}return t({type:"LOGIN_SUCCESS",payload:c}),localStorage.setItem("currentUser",JSON.stringify(c)),e.abrupt("return",c);case 13:t({type:"LOGIN_ERROR",error:c.errors[0]}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t({type:"LOGIN_ERROR",error:e.t0});case 19:case"end":return e.stop()}}),e,null,[[1,16]])})))).apply(this,arguments)}function g(){return(g=Object(p.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"LOGOUT"}),localStorage.removeItem("currentUser"),localStorage.removeItem("token");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=n(4),x=localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")):"",m={userDetails:x,token:localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")).jwt_token:"",loading:!1,errorMessage:null,userIsLoggedIn:!!x},w=function(e,t){switch(t.type){case"REQUEST_LOGIN":return Object(v.a)(Object(v.a)({},e),{},{loading:!0});case"LOGIN_SUCCESS":return Object(v.a)(Object(v.a)({},e),{},{userDetails:t.payload,token:t.payload.jwt_token,loading:!1,userIsLoggedIn:!0});case"LOGOUT":return Object(v.a)(Object(v.a)({},e),{},{user:"",token:"",userIsLoggedIn:!1});case"LOGIN_ERROR":return Object(v.a)(Object(v.a)({},e),{},{loading:!1,errorMessage:t.error});default:throw new Error("Unhandled action type: ".concat(t.type))}},y=a.a.createContext(),_=a.a.createContext();function S(){var e=a.a.useContext(y);if(void 0===e)throw new Error("useAuthState must be used within a AuthProvider");return e}function k(){var e=a.a.useContext(_);if(void 0===e)throw new Error("useAuthDispatch must be used within a AuthProvider");return e}var C=function(e){var t=e.children,n=Object(o.useReducer)(w,m),a=Object(d.a)(n,2),c=a[0],r=a[1];return Object(l.jsx)(y.Provider,{value:c,children:Object(l.jsx)(_.Provider,{value:r,children:t})})},N=function(e){return e.ok?e.json():e.statusText},T=function(e,t,n){fetch(e,t).then(N).then((function(e){return n(e)})).catch((function(e){return console.log(e)}))};function D(e){var t=e.show,n=e.onClose,a=e.children,c=Object(o.useRef)();return Object(o.useEffect)((function(){var e=function(e){t&&c.current&&!c.current.contains(e.target)&&n()};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[t]),Object(l.jsx)(l.Fragment,{children:t?Object(l.jsx)("div",{className:"modal-window",children:Object(l.jsxs)("div",{ref:c,children:[Object(l.jsx)("a",{href:"#",onClick:n,title:"Close",className:"modal-close",children:"Close"}),a]})}):""})}var I=n(15),E=function(e){var t=e.formType,n=e.values,a=e.onSuccess,c={field_amount:"",field_date:(new Date).toISOString().substr(0,10),field_category:"",field_description:""},r=Object(o.useState)("add"===t?c:n),i=Object(d.a)(r,2),s=i[0],u=i[1],j=S().token,h=function(e){var t=e.target.value;u(Object(v.a)(Object(v.a)({},s),{},Object(I.a)({},e.target.name,t)))};return Object(l.jsxs)("div",{children:[Object(l.jsx)("h2",{children:"add"===t?"Add transaction":"Edit transaction"}),Object(l.jsxs)("form",{className:"add-transaction",onSubmit:function(e){e.preventDefault();var o={type:"transaction",title:[s.field_date],field_amount:[s.field_amount],field_category:[s.field_category],field_date:[s.field_date],field_description:[s.field_description]},r={method:"add"===t?"POST":"PATCH",headers:new Headers({Accept:"application/json","Content-Type":"application/json","JWT-Authorization":"Bearer "+j}),body:JSON.stringify(o)},i="add"===t?"https://dev-expenses-api.pantheonsite.io/node?_format=json":"https://dev-expenses-api.pantheonsite.io/node/".concat(n.nid,"?_format=json");T(i,r,(function(e){e.nid?(a(),alert("Success!"),u(c)):alert("Something went wrong, please contact Constantin :)")}))},children:[Object(l.jsx)("input",{required:!0,placeholder:"Amount",type:"number",name:"field_amount",value:s.field_amount,onChange:h}),Object(l.jsx)("input",{required:!0,placeholder:"Date",type:"date",name:"field_date",value:s.field_date,onChange:h}),Object(l.jsxs)("select",{required:!0,name:"field_category",value:s.field_category,onChange:h,children:[Object(l.jsx)("option",{value:"",children:"Category"}),Object(l.jsx)("option",{value:"1",children:"Clothing"}),Object(l.jsx)("option",{value:"2",children:"Entertainment"}),Object(l.jsx)("option",{value:"3",children:"Food"}),Object(l.jsx)("option",{value:"4",children:"Gifts"}),Object(l.jsx)("option",{value:"5",children:"Household Items/Supplies"}),Object(l.jsx)("option",{value:"6",children:"Housing"}),Object(l.jsx)("option",{value:"7",children:"Medical/Healthcare"}),Object(l.jsx)("option",{value:"8",children:"Personal"}),Object(l.jsx)("option",{value:"9",children:"Transportation"}),Object(l.jsx)("option",{value:"10",children:"Utilities"})]}),Object(l.jsx)("textarea",{placeholder:"Description",name:"field_description",rows:"3",value:s.field_description,onChange:h}),Object(l.jsx)("input",{type:"submit",value:"add"===t?"Add transaction":"Edit transaction"})]})]})},L=function(){var e,t=S(),n=t.userDetails,a=t.token,c=Object(o.useState)({}),r=Object(d.a)(c,2),i=r[0],s=r[1],u=Object(o.useState)(!1),j=Object(d.a)(u,2),h=j[0],p=j[1],b=Object(o.useState)(!1),f=Object(d.a)(b,2),O=f[0],g=f[1],v=function(){var e={method:"GET",headers:new Headers({Accept:"application/json","Content-Type":"application/json","JWT-Authorization":"Bearer "+a})};T("https://dev-expenses-api.pantheonsite.io/user-expenses?_format=json",e,(function(e){var t={},n={};e.forEach((function(e){var o=new Date(e.field_date),a="".concat(o.toLocaleString("default",{month:"long"})," ").concat(o.getFullYear());t[a]||(t[a]=[]),n[a]||(n[a]=0),t[a].push(e),n[a]+=parseInt(e.field_amount)})),s({groupedData:t,totals:n})}))};Object(o.useEffect)((function(){v()}),[]);var x=Object(o.useState)({}),m=Object(d.a)(x,2),w=m[0],y=m[1],_=function(e){var t=JSON.parse(e.currentTarget.getAttribute("data-values"));y(t),g(!0)},k=function(e,t){!function(e,t,n){var o={method:"DELETE",headers:new Headers({Accept:"application/json","Content-Type":"application/json","JWT-Authorization":"Bearer "+t})};fetch("https://dev-expenses-api.pantheonsite.io/node/".concat(e,"?_format=json"),o).then((function(e){n(e)}))}(e,t,(function(e){e.ok?alert("Transaction was successfully deleted."):alert("Something went wrong."),p(!1),v()}))};return Object(l.jsxs)("div",{children:[Object(l.jsxs)(D,{show:h,onClose:function(){return p(!1)},children:[Object(l.jsx)("h3",{children:"Are you sure you want to delete the transaction?"}),Object(l.jsx)("button",{onClick:function(){return k(h,a)},className:"button logout",children:"Yes, remove the transaction"})]}),Object(l.jsx)(D,{show:O,onClose:function(){return g(!1)},children:Object(l.jsx)(E,{formType:"edit",values:w,onSuccess:function(){g(!1),v()}})}),Object(l.jsx)("h2",{children:"Expenses"}),Object(l.jsxs)("h4",{children:["Hi, ",null===n||void 0===n||null===(e=n.current_user)||void 0===e?void 0:e.name,"!"]}),0===Object.keys(i).length?"":Object(l.jsx)("div",{children:Object.keys(i.groupedData).map((function(e,t){return Object(l.jsxs)("div",{className:"table-wrapper",children:[Object(l.jsxs)("div",{className:"month-badge",children:[e,": ",i.totals[e]]}),Object(l.jsxs)("table",{className:"expenses-table",cellSpacing:"0",cellPadding:"0",children:[Object(l.jsx)("thead",{children:Object(l.jsxs)("tr",{children:[Object(l.jsx)("th",{children:"Date"}),Object(l.jsx)("th",{children:"Amount"}),Object(l.jsx)("th",{children:"Category"}),Object(l.jsx)("th",{children:"Description"}),Object(l.jsx)("th",{}),Object(l.jsx)("th",{})]})}),Object(l.jsx)("tbody",{children:Object.keys(i.groupedData[e]).map((function(t,n){return Object(l.jsxs)("tr",{children:[Object(l.jsx)("td",{children:i.groupedData[e][n].field_date}),Object(l.jsx)("td",{children:i.groupedData[e][n].field_amount}),Object(l.jsx)("td",{children:i.groupedData[e][n].field_category_name}),Object(l.jsx)("td",{children:i.groupedData[e][n].field_description}),Object(l.jsx)("td",{children:Object(l.jsx)("button",{"data-values":JSON.stringify({nid:i.groupedData[e][n].nid,field_date:i.groupedData[e][n].field_date,field_amount:i.groupedData[e][n].field_amount,field_category:i.groupedData[e][n].field_category,field_description:i.groupedData[e][n].field_description}),onClick:_,className:"btn-outline",children:"Edit"})}),Object(l.jsx)("td",{children:Object(l.jsx)("button",{"data-nid":i.groupedData[e][n].nid,onClick:function(e){return p(e.currentTarget.getAttribute("data-nid"))},className:"btn-outline",children:"Delete"})})]},i.groupedData[e][n].nid)}))})]})]},t)}))})]})},P=n(22),A=n.n(P),U=[{path:"/test/build",component:function(){var e=k(),t=Object(s.g)(),n=S(),o=n.loading,a=n.errorMessage;n.userIsLoggedIn&&t.push("/test/home");var c=function(){var n=Object(p.a)(h.a.mark((function n(o){var a;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a={access_token:o.accessToken},n.prev=1,n.next=4,f(e,a);case 4:if(n.sent.current_user){n.next=7;break}return n.abrupt("return");case 7:t.push("/test/home"),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),console.log(n.t0);case 13:case"end":return n.stop()}}),n,null,[[1,10]])})));return function(e){return n.apply(this,arguments)}}();return Object(l.jsxs)("div",{children:[Object(l.jsx)("h4",{children:"Please login using Google in order to access app functionality."}),a?Object(l.jsxs)("p",{children:["We have some errors: ",a]}):null,Object(l.jsx)(A.a,{clientId:"954790461001-2p4vab8hud9u6mj4n6hb6iio4uaiofe5.apps.googleusercontent.com",buttonText:"Login",render:function(e){return Object(l.jsx)("button",{onClick:e.onClick,className:"button logout",disabled:o,children:"Log in"})},onSuccess:c,onFailure:function(e){console.log(e)},cookiePolicy:"single_host_origin",disabled:o})]})},isPrivate:!1},{path:"/test/charts",component:u,isPrivate:!0},{path:"/test/home",component:L,isPrivate:!0},{path:"/test/logout",component:function(){var e=k(),t=Object(s.g)();return Object(l.jsxs)("div",{children:[Object(l.jsx)("h3",{children:"Do you want to logout?"}),Object(l.jsx)("button",{className:"button logout",onClick:function(n){n.preventDefault(),function(e){g.apply(this,arguments)}(e),t.push("/test/build")},children:"Logout"})]})},isPrivate:!0},{path:"/test/add-transaction",component:function(){return Object(l.jsx)(E,{formType:"add",onSuccess:function(){}})},isPrivate:!0}],R=n(14);function G(){var e=S().userIsLoggedIn,t=Object(o.useState)("closed"),n=Object(d.a)(t,2),a=n[0],c=n[1],r=Object(o.useState)(null),s=Object(d.a)(r,2),u=s[0],j=s[1],h=Object(o.useState)(null),p=Object(d.a)(h,2),b=p[0],f=p[1];return Object(l.jsx)("div",{className:"navbar ".concat(a),onTouchStart:function(e){return function(e){var t=e.touches[0];j(t.clientX),f(t.clientY)}(e)},onTouchMove:function(e){return function(e){if(u&&b){var t=e.touches[0].clientX,n=e.touches[0].clientY,o=u-t,a=b-n;Math.abs(o)<Math.abs(a)&&c(a>0?"open":"closed"),j(null),f(null)}}(e)},children:Object(l.jsxs)("ul",{children:[Object(l.jsx)("li",{children:Object(l.jsx)(i.b,{activeClassName:"selected",className:"not-selected",to:"/test/home",exact:!0,children:Object(l.jsx)(R.b,{})})}),Object(l.jsx)("li",{children:Object(l.jsx)(i.b,{to:"/test/charts",activeClassName:"selected",className:"not-selected",exact:!0,children:Object(l.jsx)(R.a,{})})}),Object(l.jsx)("li",{children:Object(l.jsx)(i.b,{to:"/test/add-transaction",activeClassName:"selected",className:"not-selected",exact:!0,children:Object(l.jsx)(R.c,{})})}),e?Object(l.jsx)("li",{children:Object(l.jsx)(i.b,{to:"/test/logout",activeClassName:"selected",className:"not-selected",exact:!0,children:Object(l.jsx)(R.d,{})})}):""]})})}var J=n(24),W=function(e){var t=e.component,n=e.path,o=e.isPrivate,a=Object(J.a)(e,["component","path","isPrivate"]),c=S();return Object(l.jsx)(s.b,Object(v.a)({path:n,render:function(e){return o&&!Boolean(c.token)?Object(l.jsx)(s.a,{to:{pathname:"/test/build"}}):Object(l.jsx)(t,Object(v.a)({},e))}},a))};var F=function(){return Object(l.jsx)(C,{children:Object(l.jsxs)(i.a,{children:[Object(l.jsx)(G,{}),Object(l.jsx)(s.d,{children:U.map((function(e){return Object(l.jsx)(W,{exact:!0,path:e.path,component:e.component,isPrivate:e.isPrivate},e.path)}))})]})})},H=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function M(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var B=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,39)).then((function(t){var n=t.getCLS,o=t.getFID,a=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),o(e),a(e),c(e),r(e)}))};r.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(F,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/test/build",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/test/build","/service-worker.js");H?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):M(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):M(t,e)}))}}({onUpdate:function(e){window.location.reload()}}),B()}},[[38,1,2]]]);
//# sourceMappingURL=main.8db42fe0.chunk.js.map